# Maintainer: Shivam Mudotia (shivam.mudotia@nagarro.com)
#!/bin/bash
# 
Grafana_URL=localhost:3000;
InfluxDB_URL=influxdb:8086;
Prometheus_URL=prometheus-server;

echo "Grafana:"$Grafana_URL;
echo "InfluxDB:"$InfluxDB_URL;
echo "PrometheusDB:"$Prometheus_URL;

# Token generation

if [ -f "/tmp/token" ]; then
  export token=$(cat /tmp/token)
else
  token=$(curl -X POST -H "Content-Type: application/json" -d '{"name":"apikeycurl", "role": "Admin"}' 'http://admin:GrafanaAdmin%40123@'$Grafana_URL'/api/auth/keys' | jq -r '.key'); 
  echo $token > /tmp/token
fi

# Jmeter
# Creating jmeter database on influxDB
curl -XPOST 'http://'$InfluxDB_URL'/query' --data-urlencode 'q=CREATE DATABASE 'jmeter'';

# Locust
# Creating locust database to store test result on influxD
curl -XPOST 'http://'$InfluxDB_URL'/query' --data-urlencode 'q=CREATE DATABASE 'locust_db'';

# Telegraf
# Creating locust database to store test result on influxD
curl -XPOST 'http://'$InfluxDB_URL'/query' --data-urlencode 'q=CREATE DATABASE 'telegraf'';


# Creating Jmeter Influxdb datasource
curl --location --request POST 'http://'$Grafana_URL'/api/datasources' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw '{"name": "InfluxDB","type": "influxdb","typeLogoUrl": "","access": "proxy","url": "http://'$InfluxDB_URL'","password": "","user": "admin","database": "jmeter","basicAuth": false,"basicAuthUser": "","basicAuthPassword": "","withCredentials": false,"isDefault": false,"jsonData": {},"secureJsonFields": {"password": true},"version": 2,"readOnly": false}';

# Creating Locust influxDB datasource
curl --location --request POST 'http://'$Grafana_URL'/api/datasources' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw '{"name": "locustDB","type": "influxdb","typeLogoUrl": "","access": "proxy","url": "http://'$InfluxDB_URL'","password": "","user": "admin","database": "locust_db","basicAuth": false,"basicAuthUser": "","basicAuthPassword": "","withCredentials": false,"isDefault": false,"jsonData": {},"secureJsonFields": {"password": true},"version": 2,"readOnly": false}';

# Creating Prometheus datasource
curl --location --request POST 'http://'$Grafana_URL'/api/datasources' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw '{"name": "PrometheusDB","type": "prometheus","typeLogoUrl": "","access": "proxy","url": "http://'$Prometheus_URL'","password": "","user": "admin","database": "jmeter","basicAuth": false,"basicAuthUser": "","basicAuthPassword": "","withCredentials": false,"isDefault": false,"jsonData": {},"secureJsonFields": {"password": true},"version": 2,"readOnly": false}';

# Creating Telegraf influxDB datasource
curl --location --request POST 'http://'$Grafana_URL'/api/datasources' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw '{"name": "InfluxDB-telegraf","type": "influxdb","typeLogoUrl": "","access": "proxy","url": "http://'$InfluxDB_URL'","password": "","user": "admin","database": "telegraf","basicAuth": false,"basicAuthUser": "","basicAuthPassword": "","withCredentials": false,"isDefault": false,"jsonData": {},"secureJsonFields": {"password": true},"version": 2,"readOnly": false}'|| true;

# Importing compare queries plugin
curl --location --request POST 'http://'$Grafana_URL'/api/datasources' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw '{"name": "CompareQueries", "type": "autohome-comparequeries-datasource", "access": "proxy" }';



# Jmeter InfluxDB Dashboard
curl --location --request POST 'http://'$Grafana_URL'/api/dashboards/db' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw '{"meta": {"type": "db","canSave": true,"canEdit": true,"canAdmin": true,"canStar": true,"slug": "jmeter-dashboard-influx-db","url": "/d/CLA48IInk/jmeter-dashboard-influx-db","expires": "0001-01-01T00:00:00Z","created": "2021-11-26T07:07:22Z","updated": "2021-11-26T08:12:47Z","updatedBy": "admin","createdBy": "Anonymous","version": 8,"hasAcl": false,"isFolder": false,"folderId": 0,"folderUid": "","folderTitle": "General","folderUrl": "","provisioned": false,"provisionedExternalId": ""},"dashboard": {"annotations": {"list": [{"builtIn": 1,"datasource": "${data_source}","enable": true,"hide": false,"iconColor": "light-blue","name": "Start/Stop Marker","query": "select text from events where $timeFilter","target": {"limit": 100,"matchAny": false,"tags": [],"type": "dashboard"},"type": "dashboard"}]},"description": "Monitoring the Load Test Execution","editable": true,"fiscalYearStartMonth": 0,"gnetId": null,"graphTooltip": 0,"id": null,"links": [],"liveNow": false,"panels": [{"collapsed": false,"datasource": null,"gridPos": {"h": 1,"w": 24,"x": 0,"y": 0},"id": 2,"panels": [],"title": "Summary","type": "row"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]}},"overrides": []},"gridPos": {"h": 6,"w": 5,"x": 0,"y": 1},"id": 4,"interval": "[[send_interval]]s","options": {"colorMode": "value","graphMode": "none","justifyMode": "auto","orientation": "auto","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"text": {},"textMode": "auto"},"pluginVersion": "8.2.5","targets": [{"query": "SELECT sum(\"count\")  FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" = '\''all'\'') AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Total Requests","type": "stat"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"mappings": [{"options": {"match": "null","result": {"index": 0,"text": "0"}},"type": "special"}],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "bytes"},"overrides": []},"gridPos": {"h": 6,"w": 5,"x": 5,"y": 1},"id": 8,"interval": "[[send_interval]]s","options": {"colorMode": "value","graphMode": "none","justifyMode": "auto","orientation": "auto","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"text": {},"textMode": "auto"},"pluginVersion": "8.2.5","targets": [{"query": "SELECT sum(\"rb\")  FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" = '\''all'\'') AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Received Bytes","type": "stat"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"mappings": [{"options": {"match": "null","result": {"index": 0,"text": "0"}},"type": "special"}],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "bytes"},"overrides": []},"gridPos": {"h": 6,"w": 4,"x": 10,"y": 1},"id": 10,"interval": "[[send_interval]]s","options": {"colorMode": "value","graphMode": "none","justifyMode": "auto","orientation": "auto","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"text": {},"textMode": "auto"},"pluginVersion": "8.2.5","targets": [{"query": "SELECT sum(\"sb\")  FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" = '\''all'\'') AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Send Bytes","type": "stat"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "dark-red","value": null}]}},"overrides": []},"gridPos": {"h": 6,"w": 4,"x": 14,"y": 1},"id": 6,"interval": "[[send_interval]]s","options": {"colorMode": "value","graphMode": "none","justifyMode": "auto","orientation": "auto","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"text": {},"textMode": "auto"},"pluginVersion": "8.2.5","targets": [{"query": "SELECT sum(\"countError\")  FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" = '\''all'\'') AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Failed Requests","type": "stat"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"mappings": [{"options": {"match": "null","result": {"color": "semi-dark-orange","index": 0,"text": "0"}},"type": "special"}],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "semi-dark-orange","value": 0},{"color": "dark-red","value": 1}]},"unit": "percent"},"overrides": []},"gridPos": {"h": 6,"w": 6,"x": 18,"y": 1},"id": 12,"interval": "[[send_interval]]s","options": {"orientation": "auto","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"showThresholdLabels": false,"showThresholdMarkers": true,"text": {}},"pluginVersion": "8.2.5","targets": [{"query": "SELECT sum(\"error\") / sum(\"all\")*100 FROM (SELECT sum(\"count\") AS \"all\" FROM \"$measurement_name\" WHERE \"transaction\" = '\''all'\'' AND \"application\" =~ /^$application$/ AND $timeFilter GROUP BY time($__interval) fill(null)), (SELECT sum(\"countError\") AS \"error\" FROM \"$measurement_name\" WHERE \"transaction\" = '\''all'\'' AND \"application\" =~ /^$application$/ AND $timeFilter GROUP BY time($__interval) fill(null))","rawQuery": true,"refId": "A"}],"title": "Error Rate","type": "gauge"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 13,"gradientMode": "opacity","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]}},"overrides": []},"gridPos": {"h": 7,"w": 9,"x": 0,"y": 7},"id": 18,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["min","max","mean"],"displayMode": "table","placement": "bottom"},"tooltip": {"mode": "single"}},"targets": [{"alias": "Requests/Sec","query": "SELECT mean(\"count\")/ $send_interval   FROM \"$measurement_name\" WHERE (\"transaction\" = '\''all'\'' AND \"application\" =~ /^$application$/) AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Throughput","type": "timeseries"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"fixedColor": "dark-red","mode": "fixed"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 40,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "never","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "short"},"overrides": []},"gridPos": {"h": 7,"w": 7,"x": 9,"y": 7},"id": 16,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["sum"],"displayMode": "table","placement": "bottom"},"tooltip": {"mode": "single"}},"pluginVersion": "8.1.2","targets": [{"alias": "Errors","query": "SELECT sum(\"countError\") FROM \"$measurement_name\" WHERE (\"transaction\" = '\''all'\'' AND \"application\" =~ /^$application$/) AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"timeFrom": null,"timeShift": null,"title": "Total Errors","type": "timeseries"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"fixedColor": "semi-dark-purple","mode": "fixed"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 40,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "never","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "short"},"overrides": []},"gridPos": {"h": 7,"w": 8,"x": 16,"y": 7},"id": 14,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["lastNotNull"],"displayMode": "table","placement": "bottom"},"tooltip": {"mode": "single"}},"pluginVersion": "8.1.2","targets": [{"alias": "Threads","query": "SELECT last(\"maxAT\") FROM \"$measurement_name\" WHERE (\"transaction\" = '\''internal'\'' AND \"application\" =~ /^$application$/) AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"timeFrom": null,"timeShift": null,"title": "Active Threads","type": "timeseries"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "ms"},"overrides": []},"gridPos": {"h": 8,"w": 12,"x": 0,"y": 14},"id": 20,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["min","max","mean"],"displayMode": "table","placement": "right"},"tooltip": {"mode": "single"}},"targets": [{"alias": "$tag_transaction","query": "SELECT mean(\"avg\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/) AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Average Response Time","type": "timeseries"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "ms"},"overrides": []},"gridPos": {"h": 8,"w": 12,"x": 12,"y": 14},"id": 22,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["min","max","mean"],"displayMode": "table","placement": "right"},"tooltip": {"mode": "single"}},"targets": [{"alias": "$tag_transaction","query": "SELECT mean(\"pct90.0\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/) AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "90th Percentile Response Time","type": "timeseries"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "bytes"},"overrides": []},"gridPos": {"h": 7,"w": 24,"x": 0,"y": 22},"id": 38,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["min","max","mean"],"displayMode": "table","placement": "right"},"tooltip": {"mode": "single"}},"targets": [{"alias": "Send Bytes: $tag_transaction","query": "SELECT mean(\"sb\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/) AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "A","resultFormat": "time_series"},{"alias": "Received Bytes: $tag_transaction","hide": false,"query": "SELECT mean(\"rb\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/) AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "B","resultFormat": "time_series"}],"title": "Network Traffic","type": "timeseries"},{"datasource": "InfluxDB","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"custom": {"align": "center","displayMode": "auto","filterable": true},"decimals": 2,"mappings": [],"noValue": "0","thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]}},"overrides": [{"matcher": {"id": "byName","options": "Errors"},"properties": [{"id": "mappings","value": [{"options": {"match": "null","result": {"index": 0,"text": "0"}},"type": "special"},{"options": {"match": "empty","result": {"index": 1,"text": "0"}},"type": "special"}]}]}]},"gridPos": {"h": 8,"w": 24,"x": 0,"y": 29},"id": 40,"options": {"frameIndex": 0,"showHeader": true,"sortBy": [{"desc": false,"displayName": "Transaction"}]},"pluginVersion": "8.2.5","targets": [{"query": "SELECT sum(\"count\") as \"Count\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''all'\'' and \"transaction\" !='\''all'\'') AND $timeFilter  GROUP BY \"transaction\"","rawQuery": true,"refId": "A","resultFormat": "table"},{"hide": false,"query": "SELECT sum(\"count\") as \"Errors\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''ko'\'') AND $timeFilter  GROUP BY \"transaction\"","rawQuery": true,"refId": "B","resultFormat": "table"},{"hide": false,"query": "SELECT mean(\"avg\") as \"Average Response Time\", mean(\"pct90.0\") as \"90th Perc Response Time\", mean(\"pct95.0\") as \"95th Perc Response Time\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''all'\'' and \"transaction\" !='\''all'\'') AND $timeFilter  GROUP BY \"transaction\"","rawQuery": true,"refId": "C","resultFormat": "table"}],"title": "Transaction Details","transformations": [{"id": "seriesToColumns","options": {"byField": "transaction"}},{"id": "organize","options": {"excludeByName": {"Time 1": true,"Time 2": true,"Time 3": true},"indexByName": {},"renameByName": {"transaction": "Transaction"}}}],"type": "table"},{"collapsed": false,"datasource": null,"gridPos": {"h": 1,"w": 24,"x": 0,"y": 37},"id": 26,"panels": [],"title": "Transaction Summary for $transaction","type": "row"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "light-green","value": null}]}},"overrides": []},"gridPos": {"h": 7,"w": 9,"x": 0,"y": 38},"id": 28,"interval": "[[send_interval]]s","options": {"colorMode": "value","graphMode": "none","justifyMode": "auto","orientation": "auto","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"text": {},"textMode": "auto"},"pluginVersion": "8.2.5","targets": [{"query": "SELECT sum(\"count\")  FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" = '\''$transaction'\'' AND \"statut\" = '\''all'\'') AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Total Requests for ${transaction}","type": "stat"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"mappings": [{"options": {"match": "null","result": {"index": 0,"text": "0"}},"type": "special"}],"thresholds": {"mode": "absolute","steps": [{"color": "dark-red","value": null}]}},"overrides": []},"gridPos": {"h": 7,"w": 8,"x": 9,"y": 38},"id": 30,"interval": "[[send_interval]]s","options": {"colorMode": "value","graphMode": "none","justifyMode": "auto","orientation": "auto","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"text": {},"textMode": "auto"},"pluginVersion": "8.2.5","targets": [{"query": "SELECT sum(\"count\")  FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" =~ /^$transaction$/ AND \"statut\" = '\''ko'\'') AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Failed Requests for $transaction","type": "stat"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"mappings": [{"options": {"match": "null","result": {"color": "semi-dark-orange","index": 0,"text": "0"}},"type": "special"}],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "semi-dark-orange","value": 0},{"color": "dark-red","value": 1}]},"unit": "percent"},"overrides": []},"gridPos": {"h": 7,"w": 7,"x": 17,"y": 38},"id": 32,"interval": "[[send_interval]]s","options": {"orientation": "auto","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"showThresholdLabels": false,"showThresholdMarkers": true,"text": {}},"pluginVersion": "8.2.5","targets": [{"query": "SELECT sum(\"error\") / sum(\"all\")*100 FROM (SELECT sum(\"count\") AS \"all\" FROM \"$measurement_name\" WHERE \"transaction\" =~ /^$transaction$/ AND \"statut\" = '\''all'\'' AND \"application\" =~ /^$application$/ AND $timeFilter GROUP BY time($__interval) fill(null)), (SELECT sum(\"count\") AS \"error\" FROM \"$measurement_name\" WHERE \"transaction\" =~ /^$transaction$/ AND \"statut\" = '\''ko'\'' AND \"application\" =~ /^$application$/ AND $timeFilter GROUP BY time($__interval) fill(null))","rawQuery": true,"refId": "A"}],"title": "Error Rate for $transaction","type": "gauge"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 13,"gradientMode": "opacity","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]}},"overrides": []},"gridPos": {"h": 8,"w": 12,"x": 0,"y": 45},"id": 36,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["min","max","mean"],"displayMode": "table","placement": "bottom"},"tooltip": {"mode": "single"}},"targets": [{"alias": "Requests/Sec","query": "SELECT mean(\"count\")/ $send_interval   FROM \"$measurement_name\" WHERE (\"transaction\" = '\''$transaction'\'' AND \"application\" =~ /^$application$/ AND \"statut\"='\''ok'\'') AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Throughput - $transaction","type": "timeseries"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "ms"},"overrides": []},"gridPos": {"h": 8,"w": 12,"x": 12,"y": 45},"id": 34,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["min","max","mean"],"displayMode": "table","placement": "right"},"tooltip": {"mode": "single"}},"targets": [{"alias": "Average","query": "SELECT mean(\"avg\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" =~ /^$transaction$/ AND \"statut\" = '\''ok'\'') AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "A"},{"alias": "90th Percentile","hide": false,"query": "SELECT mean(\"pct90.0\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" =~ /^$transaction$/ AND \"statut\" = '\''ok'\'') AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "B"},{"alias": "95th Percentile","hide": false,"query": "SELECT mean(\"pct95.0\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" =~ /^$transaction$/ AND \"statut\" = '\''ok'\'') AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "C"},{"alias": "99th Percentile","hide": false,"query": "SELECT mean(\"pct99.0\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" =~ /^$transaction$/ AND \"statut\" = '\''ok'\'') AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "D"}],"title": "Response Time - $transaction","type": "timeseries"}],"refresh": false,"schemaVersion": 32,"style": "dark","tags": [],"templating": {"list": [{"current": {"selected": false,"text": "InfluxDB","value": "InfluxDB"},"description": "DataSource for Dashboard","error": null,"hide": 0,"includeAll": false,"label": null,"multi": false,"name": "data_source","options": [],"query": "influxdb","queryValue": "","refresh": 1,"regex": "","skipUrlSync": false,"type": "datasource"},{"allValue": null,"current": {"selected": false,"text": "Test_Demo","value": "Test_Demo"},"datasource": "${data_source}","definition": "SHOW TAG VALUES FROM \"jmeter\" WITH KEY = \"application\"","description": null,"error": null,"hide": 0,"includeAll": false,"label": null,"multi": false,"name": "application","options": [],"query": "SHOW TAG VALUES FROM \"jmeter\" WITH KEY = \"application\"","refresh": 1,"regex": "","skipUrlSync": false,"sort": 0,"type": "query"},{"allValue": null,"current": {"selected": false,"text": "Google_Transaction","value": "Google_Transaction"},"datasource": "${data_source}","definition": "SHOW TAG VALUES FROM \"jmeter\" WITH KEY = \"transaction\" WHERE \"application\" =~ /^$application$/ AND  \"transaction\" != '\''internal'\'' AND \"transaction\" != '\''all'\''","description": null,"error": null,"hide": 0,"includeAll": false,"label": null,"multi": false,"name": "transaction","options": [],"query": "SHOW TAG VALUES FROM \"jmeter\" WITH KEY = \"transaction\" WHERE \"application\" =~ /^$application$/ AND  \"transaction\" != '\''internal'\'' AND \"transaction\" != '\''all'\''","refresh": 1,"regex": "","skipUrlSync": false,"sort": 0,"type": "query"},{"description": null,"error": null,"hide": 2,"label": null,"name": "measurement_name","query": "jmeter","skipUrlSync": false,"type": "constant"},{"description": null,"error": null,"hide": 2,"label": null,"name": "send_interval","query": "5","skipUrlSync": false,"type": "constant"}]},"time": {"from": "now-30m","to": "now"},"timepicker": {"hidden": false},"timezone": "","title": "Jmeter Dashboard Influx DB","uid": "CLA48IInk","version": 8}}';

# Trend-analysis-Jmeter Dashboard
curl --location --request POST 'http://'$Grafana_URL'/api/dashboards/db' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw '{"meta": {"type": "db","canSave": true,"canEdit": true,"canAdmin": true,"canStar": true,"slug": "trend-analysis-jmeter","url": "/d/3lSI40Kpk/trend-analysis-jmeter","expires": "0001-01-01T00:00:00Z","created": "2021-12-10T16:57:49+05:30","updated": "2021-12-28T13:10:56+05:30","updatedBy": "admin","createdBy": "Anonymous","version": 17,"hasAcl": false,"isFolder": false,"folderId": 0,"folderUid": "","folderTitle": "General","folderUrl": "","provisioned": false,"provisionedExternalId": ""},"dashboard": {"annotations": {"list": [{"builtIn": 1,"datasource": "${data_source}","enable": true,"hide": false,"iconColor": "rgba(0, 211, 255, 1)","name": "Start/Stop Marker","query": "select text from events where $timeFilter","target": {"limit": 100,"matchAny": false,"tags": [],"type": "dashboard"},"type": "dashboard"}]},"editable": true,"gnetId": null,"graphTooltip": 0,"id": null,"links": [],"panels": [{"collapsed": false,"datasource": null,"gridPos": {"h": 1,"w": 24,"x": 0,"y": 0},"id": 12,"panels": [],"title": "Summary - Trend Analysis","type": "row"},{"datasource": "CompareQueries","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 80}]}},"overrides": []},"gridPos": {"h": 9,"w": 12,"x": 0,"y": 1},"id": 14,"interval": "[[send_interval]]s","options": {"legend": {"calcs": [],"displayMode": "list","placement": "bottom"},"tooltip": {"mode": "single"}},"targets": [{"alias": "Latest Test","datasource": "${data_source}","query": "SELECT mean(\"count\")/ $send_interval   FROM \"$measurement_name\" WHERE (\"transaction\" = '\''all'\'' AND \"application\" =~ /^$application$/) AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"},{"datasource": "CompareQueries","hide": false,"process": true,"query": "A","refId": "B","timeShifts": [{"$$hashKey": "object:9","alias": "Previous test","aliasType": "absolute","id": 0,"value": "${timeshift}"}]}],"title": "Throughput in Requests/Sec","type": "timeseries"},{"datasource": "CompareQueries","fieldConfig": {"defaults": {"color": {"fixedColor": "purple","mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "never","spanNulls": false,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]}},"overrides": []},"gridPos": {"h": 9,"w": 12,"x": 12,"y": 1},"id": 30,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["lastNotNull"],"displayMode": "table","placement": "bottom"},"tooltip": {"mode": "single"}},"targets": [{"alias": "Latest Test","datasource": "${data_source}","query": "SELECT last(\"maxAT\") FROM \"$measurement_name\" WHERE (\"transaction\" = '\''internal'\'' AND \"application\" =~ /^$application$/) AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"},{"datasource": "CompareQueries","hide": false,"process": true,"query": "A","refId": "B","timeShifts": [{"$$hashKey": "object:14","alias": "Previous Test","aliasType": "absolute","id": 0,"value": "${timeshift}"}]}],"title": "Active Threads","type": "timeseries"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 80}]}},"overrides": []},"gridPos": {"h": 9,"w": 12,"x": 0,"y": 10},"id": 18,"options": {"legend": {"calcs": [],"displayMode": "list","placement": "bottom"},"tooltip": {"mode": "single"}},"targets": [{"alias": "$metrics:$tag_transaction","query": "SELECT mean(\"${metrics}\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/) AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"title": "Latest Test - ${metrics} Response Time","type": "timeseries"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 80}]}},"overrides": []},"gridPos": {"h": 9,"w": 12,"x": 12,"y": 10},"id": 20,"options": {"legend": {"calcs": [],"displayMode": "list","placement": "bottom"},"tooltip": {"mode": "single"}},"targets": [{"alias": "$metrics:$tag_transaction","query": "SELECT mean(\"${metrics}\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/) AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "A"}],"timeShift": "${timeshift}","title": "Previous Test - ${metrics} Response Time","type": "timeseries"},{"datasource": "CompareQueries","fieldConfig": {"defaults": {"color": {"fixedColor": "red","mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 40,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "never","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "short"},"overrides": []},"gridPos": {"h": 9,"w": 12,"x": 0,"y": 19},"id": 26,"interval": "[[send_interval]]s","options": {"legend": {"calcs": ["sum"],"displayMode": "list","placement": "bottom"},"tooltip": {"mode": "single"}},"targets": [{"alias": "Latest Test","datasource": "${data_source}","query": "SELECT sum(\"countError\") FROM \"$measurement_name\" WHERE (\"transaction\" = '\''all'\'' AND \"application\" =~ /^$application$/) AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"},{"datasource": "CompareQueries","hide": false,"process": true,"query": "A","refId": "B","timeShifts": [{"$$hashKey": "object:29","alias": "Previous Test","aliasType": "absolute","id": 0,"value": "${timeshift}"}]}],"title": "Errors","type": "timeseries"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"custom": {"align": "center","displayMode": "auto"},"decimals": 2,"displayName": "","mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 80}]},"unit": "none"},"overrides": [{"matcher": {"id": "byName","options": "Errors"},"properties": [{"id": "mappings","value": [{"options": {"match": "null","result": {"index": 0,"text": "0"}},"type": "special"},{"options": {"match": "empty","result": {"index": 1,"text": "0"}},"type": "special"}]}]}]},"gridPos": {"h": 9,"w": 12,"x": 12,"y": 19},"id": 24,"options": {"showHeader": true},"pluginVersion": "8.1.2","targets": [{"query": "SELECT sum(\"count\") as \"Count\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''all'\'' and \"transaction\" !='\''all'\'') AND $timeFilter  GROUP BY \"transaction\"","rawQuery": true,"refId": "A","resultFormat": "table"},{"hide": false,"query": "SELECT sum(\"count\") as \"Errors\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''ko'\'') AND $timeFilter  GROUP BY \"transaction\"","rawQuery": true,"refId": "B","resultFormat": "table"},{"groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"hide": false,"orderByTime": "ASC","policy": "default","query": "SELECT mean(\"avg\") as \"Average RT\", mean(\"pct90.0\") as \"90%ile RT\", mean(\"pct95.0\") as \"95%ile RT\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''all'\'' and \"transaction\" !='\''all'\'') AND $timeFilter  GROUP BY \"transaction\"","rawQuery": true,"refId": "C","resultFormat": "table","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"timeShift": "${timeshift}","title": "Previous Test - Transaction Details in milliseconds","transformations": [{"id": "seriesToColumns","options": {"byField": "transaction"}},{"id": "organize","options": {"excludeByName": {"Time 1": true,"Time 2": true,"Time 3": true},"indexByName": {},"renameByName": {"Time 1": "","transaction": "Transaction"}}}],"type": "table"},{"datasource": "${data_source}","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"custom": {"align": "center","displayMode": "auto","filterable": false},"decimals": 2,"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]}},"overrides": [{"matcher": {"id": "byName","options": "Diff Count"},"properties": [{"id": "custom.displayMode","value": "color-background"},{"id": "thresholds","value": {"mode": "absolute","steps": [{"color": "semi-dark-red","value": null},{"color": "semi-dark-green","value": 0}]}}]},{"matcher": {"id": "byName","options": "Diff ART"},"properties": [{"id": "custom.displayMode","value": "color-background"},{"id": "thresholds","value": {"mode": "absolute","steps": [{"color": "semi-dark-green","value": null},{"color": "dark-red","value": 0.1}]}}]},{"matcher": {"id": "byRegexp","options": "Diff [0-9]*%ile RT"},"properties": [{"id": "custom.displayMode","value": "color-background"},{"id": "thresholds","value": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 0.1}]}}]},{"matcher": {"id": "byName","options": "Transaction Name"},"properties": [{"id": "custom.align","value": "left"}]}]},"gridPos": {"h": 7,"w": 24,"x": 0,"y": 28},"id": 34,"options": {"frameIndex": 0,"showHeader": true,"sortBy": [{"desc": false,"displayName": "Time"}]},"pluginVersion": "8.1.2","targets": [{"hide": false,"query": "SELECT sum(\"count\") as \"CountP\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''all'\'' and \"transaction\" !='\''all'\'' ) and  time >= ${__from}ms-${timeshift} and \ntime <= ${__to}ms-${timeshift} GROUP BY \"transaction\"","rawQuery": true,"refId": "A","resultFormat": "table"},{"hide": false,"query": "SELECT sum(\"count\") as \"CountL\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''all'\'' and \"transaction\" !='\''all'\'') AND  time>=${__from}ms  AND time <= ${__to}ms GROUP BY \"transaction\"","rawQuery": true,"refId": "C","resultFormat": "table"},{"hide": false,"query": "SELECT mean(\"avg\") as \"ART L\", mean(\"pct90.0\") as \"90% L\", mean(\"pct95.0\") as \"95% L\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''all'\'' and \"transaction\" !='\''all'\'') AND  time>=${__from}ms  AND time <= ${__to}ms GROUP BY \"transaction\" ","rawQuery": true,"refId": "B","resultFormat": "table"},{"hide": false,"query": "SELECT mean(\"avg\") as \"ART P\", mean(\"pct90.0\") as \"90% P\", mean(\"pct95.0\") as \"95% P\" FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ and \"statut\"='\''all'\'' and \"transaction\" !='\''all'\'') AND  time>=${__from}ms-${timeshift}  AND time <= ${__to}ms-${timeshift} GROUP BY \"transaction\"","rawQuery": true,"refId": "D","resultFormat": "table"}],"timeShift": null,"title": "Latest Test Transaction Details in milliseconds  with Comparison","transformations": [{"id": "seriesToColumns","options": {"byField": "transaction"}},{"id": "organize","options": {"excludeByName": {"CountP": false,"Time 1": true,"Time 2": true,"Time 3": true,"Time 4": true},"indexByName": {"90% L": 8,"90% P": 9,"95% L": 10,"95% P": 11,"ART L": 6,"ART P": 7,"CountL": 4,"CountP": 2,"Time 1": 1,"Time 2": 3,"Time 3": 5,"Time 4": 12,"transaction": 0},"renameByName": {"CountL": "","CountP": "","Time 1": "","transaction": "Transaction Name"}}},{"id": "calculateField","options": {"alias": "Diff. C","binary": {"left": "CountL","operator": "-","reducer": "sum","right": "CountP"},"mode": "binary","reduce": {"include": ["CountP","CountL"],"reducer": "diff"},"replaceFields": false}},{"id": "calculateField","options": {"binary": {"left": "ART L","operator": "-","reducer": "sum","right": "ART P"},"mode": "binary","reduce": {"reducer": "sum"},"replaceFields": false}},{"id": "calculateField","options": {"binary": {"left": "90% L","operator": "-","reducer": "sum","right": "90% P"},"mode": "binary","reduce": {"reducer": "sum"}}},{"id": "calculateField","options": {"binary": {"left": "95% L","operator": "-","reducer": "sum","right": "95% P"},"mode": "binary","reduce": {"reducer": "sum"}}},{"id": "organize","options": {"excludeByName": {"90% L": false,"90% P": true,"95% L": false,"95% P": true,"ART L": false,"ART P": true,"CountL": false,"CountP": true},"indexByName": {"90% L": 7,"90% L - 90% P": 9,"90% P": 8,"95% L": 10,"95% L - 95% P": 11,"95% P": 12,"ART L": 4,"ART L - ART P": 5,"ART P": 6,"CountL": 2,"CountP": 1,"Diff. C": 3,"Transaction Name": 0},"renameByName": {"90% L": "90%ile RT","90% L - 90% P": "Diff 90%ile RT","95% L": "95%ile RT","95% L - 95% P": "Diff 95%ile RT","ART L": "Avg Response Time","ART L - ART P": "Diff ART","CountL": "Count","CountP": "","Diff. C": "Diff Count"}}}],"transparent": true,"type": "table"},{"collapsed": false,"datasource": null,"gridPos": {"h": 1,"w": 24,"x": 0,"y": 35},"id": 10,"panels": [],"title": "Transaction Level Summary","type": "row"},{"datasource": "CompareQueries","fieldConfig": {"defaults": {"color": {"mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 80}]}},"overrides": []},"gridPos": {"h": 9,"w": 12,"x": 0,"y": 36},"id": 8,"interval": "[[send_interval]]s","options": {"legend": {"calcs": [],"displayMode": "list","placement": "bottom"},"tooltip": {"mode": "single"}},"targets": [{"alias": "Latest Test","datasource": "${data_source}","query": "SELECT mean(\"count\")/ $send_interval   FROM \"$measurement_name\" WHERE (\"transaction\" = '\''$transaction'\'' AND \"application\" =~ /^$application$/ AND \"statut\"='\''ok'\'') AND $timeFilter GROUP BY time($__interval) fill(null)","rawQuery": true,"refId": "A"},{"datasource": "CompareQueries","hide": false,"process": true,"query": "A","refId": "B","timeShifts": [{"$$hashKey": "object:37","alias": "Previous Test","aliasType": "absolute","id": 0,"value": "${timeshift}"}]}],"title": "Transaction Throughput - $transaction","type": "timeseries"},{"datasource": "CompareQueries","fieldConfig": {"defaults": {"color": {"fixedColor": "orange","mode": "palette-classic"},"custom": {"axisLabel": "","axisPlacement": "auto","barAlignment": 0,"drawStyle": "line","fillOpacity": 0,"gradientMode": "none","hideFrom": {"legend": false,"tooltip": false,"viz": false},"lineInterpolation": "linear","lineWidth": 1,"pointSize": 5,"scaleDistribution": {"type": "linear"},"showPoints": "auto","spanNulls": true,"stacking": {"group": "A","mode": "none"},"thresholdsStyle": {"mode": "off"}},"mappings": [],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]}},"overrides": []},"gridPos": {"h": 9,"w": 12,"x": 12,"y": 36},"id": 6,"options": {"legend": {"calcs": [],"displayMode": "list","placement": "bottom"},"tooltip": {"mode": "single"}},"targets": [{"alias": "Latest Test: $metrics","datasource": "${data_source}","query": "SELECT mean(\"${metrics}\") FROM \"$measurement_name\" WHERE (\"application\" =~ /^$application$/ AND \"transaction\" =~ /^$transaction$/ AND \"statut\" = '\''ok'\'') AND $timeFilter GROUP BY \"transaction\", time($__interval) fill(null)","rawQuery": true,"refId": "A"},{"datasource": "CompareQueries","hide": false,"process": true,"query": "A","refId": "B","timeShifts": [{"$$hashKey": "object:45","alias": "Previous Test: $metrics","aliasType": "absolute","id": 0,"value": "${timeshift}"}]}],"title": "${metrics} Response Time - $transaction","type": "timeseries"}],"refresh": false,"schemaVersion": 30,"style": "dark","tags": [],"templating": {"list": [{"current": {"selected": false,"text": "InfluxDB","value": "InfluxDB"},"description": null,"error": null,"hide": 0,"includeAll": false,"label": null,"multi": false,"name": "data_source","options": [],"query": "influxdb","queryValue": "","refresh": 1,"regex": "","skipUrlSync": false,"type": "datasource"},{"allValue": null,"current": {"selected": false,"text": "DistributedTest","value": "DistributedTest"},"datasource": "${data_source}","definition": "SHOW TAG VALUES FROM \"jmeter\" WITH KEY = \"application\"","description": null,"error": null,"hide": 0,"includeAll": false,"label": null,"multi": false,"name": "application","options": [],"query": "SHOW TAG VALUES FROM \"jmeter\" WITH KEY = \"application\"","refresh": 1,"regex": "","skipUrlSync": false,"sort": 0,"type": "query"},{"allValue": null,"current": {"selected": false,"text": "Archives","value": "Archives"},"datasource": "${data_source}","definition": "SHOW TAG VALUES FROM \"jmeter\" WITH KEY = \"transaction\" WHERE \"application\" =~ /^$application$/ AND  \"transaction\" != '\''internal'\'' AND \"transaction\" != '\''all'\''","description": null,"error": null,"hide": 0,"includeAll": false,"label": null,"multi": false,"name": "transaction","options": [],"query": "SHOW TAG VALUES FROM \"jmeter\" WITH KEY = \"transaction\" WHERE \"application\" =~ /^$application$/ AND  \"transaction\" != '\''internal'\'' AND \"transaction\" != '\''all'\''","refresh": 1,"regex": "","skipUrlSync": false,"sort": 0,"type": "query"},{"description": null,"error": null,"hide": 2,"label": null,"name": "measurement_name","query": "jmeter","skipUrlSync": false,"type": "constant"},{"current": {"selected": false,"text": "800s","value": "800s"},"description": null,"error": null,"hide": 0,"label": null,"name": "timeshift","options": [{"selected": false,"text": "800s","value": "800s"}],"query": "800s","skipUrlSync": false,"type": "textbox"},{"allValue": null,"current": {"selected": false,"text": "avg","value": "avg"},"description": null,"error": null,"hide": 0,"includeAll": false,"label": null,"multi": false,"name": "metrics","options": [{"selected": true,"text": "avg","value": "avg"},{"selected": false,"text": "pct90.0","value": "pct90.0"},{"selected": false,"text": "pct95.0","value": "pct95.0"},{"selected": false,"text": "pct99.0","value": "pct99.0"}],"query": "avg,pct90.0,pct95.0,pct99.0","queryValue": "","skipUrlSync": false,"type": "custom"},{"description": null,"error": null,"hide": 2,"label": null,"name": "send_interval","query": "5","skipUrlSync": false,"type": "constant"}]},"time": {"from": "2021-11-16T11:37:18.761Z","to": "2021-11-16T11:42:17.664Z"},"timepicker": {},"timezone": "","title": "Trend Analysis Jmeter","uid": "3lSI40Kpk","version": 17}}';

# Importing locust dashboard
curl --location --request POST 'http://'$Grafana_URL'/api/dashboards/db' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw '{"meta": {"type": "db","canSave": true,"canEdit": true,"canAdmin": true,"canStar": true,"slug": "locust-dashboard","url": "/d/l-rF7woGz/locust-dashboard","expires": "0001-01-01T00:00:00Z","created": "2022-04-27T06:14:35Z","updated": "2022-04-27T06:27:55Z","updatedBy": "admin","createdBy": "admin","version": 2,"hasAcl": false,"isFolder": false,"folderId": 0,"folderUid": "","folderTitle": "General","folderUrl": "","provisioned": false,"provisionedExternalId": ""},"dashboard": {"annotations": {"list": [{"$$hashKey": "object:10","builtIn": 1,"datasource": "-- Grafana --","enable": true,"hide": true,"iconColor": "rgba(0, 211, 255, 1)","name": "Annotations & Alerts","target": {"limit": 100,"matchAny": false,"tags": [],"type": "dashboard"},"type": "dashboard"},{"$$hashKey": "object:11","datasource": "$DB_SOURCE","enable": true,"hide": false,"iconColor": "rgba(255, 96, 96, 1)","limit": 100,"name": "Locust Events","query": "SELECT * FROM \"locust_events\"","showIn": 0,"tags": [],"tagsColumn": "locust","type": "tags"}]},"description": "","editable": true,"fiscalYearStartMonth": 0,"graphTooltip": 1,"id": "null","links": [],"liveNow": false,"panels": [{"collapsed": false,"datasource": {"uid": "$DB_SOURCE"},"gridPos": {"h": 1,"w": 24,"x": 0,"y": 0},"id": 19,"panels": [],"title": "Totals","type": "row"},{"datasource": {"uid": "$DB_SOURCE"},"description": "Current Requests Per Second","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"decimals": 0,"displayName": "RPS","mappings": [{"id": 0,"op": "=","text": "N/A","type": 1,"value": "null"}],"max": 100,"min": 0,"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null}]},"unit": "none"},"overrides": []},"gridPos": {"h": 7,"w": 4,"x": 0,"y": 1},"hideTimeOverride": false,"id": 6,"links": [],"options": {"orientation": "horizontal","reduceOptions": {"calcs": ["lastNotNull"],"fields": "","values": false},"showThresholdLabels": false,"showThresholdMarkers": true},"pluginVersion": "8.3.4","targets": [{"groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT count(counter)\nFROM \"locust_requests\"\nWHERE $timeFilter","rawQuery": true,"refId": "B","resultFormat": "table","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"timeFrom": "2s","timeShift": "2s","title": "Current Requests","type": "gauge"},{"datasource": {"uid": "$DB_SOURCE"},"description": "Total amount of requests done during the time period.","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"decimals": 0,"mappings": [{"options": {"match": "null","result": {"text": "N/A"}},"type": "special"}],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 80}]},"unit": "none"},"overrides": []},"gridPos": {"h": 7,"w": 3,"x": 4,"y": 1},"id": 27,"links": [],"maxDataPoints": 100,"options": {"colorMode": "none","graphMode": "none","justifyMode": "auto","orientation": "horizontal","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"textMode": "auto"},"pluginVersion": "8.3.4","targets": [{"groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT count(\"counter\")\nFROM \"locust_requests\"\nWHERE $timeFilter","rawQuery": true,"refId": "B","resultFormat": "time_series","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"title": "Total","type": "stat"},{"datasource": {"uid": "$DB_SOURCE"},"description": "Total Success requests","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"decimals": 0,"mappings": [{"options": {"match": "null","result": {"text": "N/A"}},"type": "special"}],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 80}]},"unit": "none"},"overrides": []},"gridPos": {"h": 7,"w": 3,"x": 7,"y": 1},"id": 13,"links": [],"maxDataPoints": 100,"options": {"colorMode": "background","graphMode": "none","justifyMode": "auto","orientation": "horizontal","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"textMode": "auto"},"pluginVersion": "8.3.4","targets": [{"groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT count(\"counter\")\nFROM \"locust_requests\"\nWHERE $timeFilter AND \"success\" = '\''True'\''","rawQuery": true,"refId": "B","resultFormat": "time_series","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"title": "Success","type": "stat"},{"datasource": {"uid": "$DB_SOURCE"},"description": "Total unhandled errors","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"decimals": 0,"mappings": [{"options": {"match": "null","result": {"text": "N/A"}},"type": "special"}],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 80}]},"unit": "none"},"overrides": []},"gridPos": {"h": 4,"w": 3,"x": 10,"y": 1},"id": 8,"interval": "","links": [],"maxDataPoints": 100,"options": {"colorMode": "background","graphMode": "none","justifyMode": "auto","orientation": "horizontal","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"textMode": "auto"},"pluginVersion": "8.3.4","targets": [{"alias": "","groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT count(\"counter\")\nFROM \"locust_requests\"\nWHERE $timeFilter AND \"success\" = '\''False'\''\nAND \"exception\" !~ /invalid-path*/ ","rawQuery": true,"refId": "B","resultFormat": "time_series","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"title": "Real Fail","type": "stat"},{"columns": [{"text": "Avg","value": "avg"},{"text": "Min","value": "min"},{"text": "Max","value": "max"},{"text": "Count","value": "count"}],"datasource": {"uid": "$DB_SOURCE"},"description": "Number of requests per second over time.","fontSize": "100%","gridPos": {"h": 7,"w": 11,"x": 13,"y": 1},"id": 4,"interval": "","showHeader": true,"sort": {"col": 0,"desc": true},"styles": [{"alias": "","align": "auto","colors": ["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals": 2,"pattern": "/.*(Min|Max|Avg)/","thresholds": [],"type": "number","unit": "ms"},{"alias": "","align": "auto","colorMode": "cell","colors": ["#56A64B","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat": "YYYY-MM-DD HH:mm:ss","decimals": 0,"mappingType": 1,"pattern": "Count","thresholds": [],"type": "number","unit": "none"}],"targets": [{"alias": "$tag_request_type $tag_name","groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"hide": false,"orderByTime": "ASC","policy": "default","query": "SELECT \"time\", \"response_time\"\nFROM \"locust_requests\"\nWHERE $timeFilter\nGROUP BY \"request_type\", \"name\"","rawQuery": true,"refId": "A","resultFormat": "time_series","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"title": "Detailed Response Time per Endpoint","transform": "timeseries_aggregations","type": "table-old"},{"datasource": {"uid": "$DB_SOURCE"},"description": "Total fake failure requests","fieldConfig": {"defaults": {"color": {"mode": "thresholds"},"decimals": 0,"mappings": [{"options": {"match": "null","result": {"text": "N/A"}},"type": "special"}],"thresholds": {"mode": "absolute","steps": [{"color": "green","value": null},{"color": "red","value": 80}]},"unit": "none"},"overrides": []},"gridPos": {"h": 3,"w": 3,"x": 10,"y": 5},"id": 28,"interval": "","links": [],"maxDataPoints": 100,"options": {"colorMode": "background","graphMode": "none","justifyMode": "auto","orientation": "horizontal","reduceOptions": {"calcs": ["sum"],"fields": "","values": false},"textMode": "auto"},"pluginVersion": "8.3.4","targets": [{"alias": "","groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT count(\"counter\")\nFROM \"locust_requests\"\nWHERE $timeFilter AND \"success\" = '\''False'\''\nAND \"exception\" =~ /invalid-path*/ ","rawQuery": true,"refId": "B","resultFormat": "time_series","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"title": "Fake Fail","type": "stat"},{"collapsed": false,"datasource": {"uid": "$DB_SOURCE"},"gridPos": {"h": 1,"w": 24,"x": 0,"y": 8},"id": 10,"panels": [],"title": "Over Time","type": "row"},{"aliasColors": {},"bars": false,"dashLength": 10,"dashes": false,"datasource": {"uid": "$DB_SOURCE"},"description": "Number of requests per second over time.","fieldConfig": {"defaults": {"links": []},"overrides": []},"fill": 1,"fillGradient": 0,"gridPos": {"h": 7,"w": 24,"x": 0,"y": 9},"hiddenSeries": false,"id": 26,"legend": {"avg": false,"current": false,"max": false,"min": false,"show": true,"total": false,"values": false},"lines": true,"linewidth": 1,"links": [],"nullPointMode": "null","options": {"alertThreshold": true},"percentage": false,"pluginVersion": "8.3.4","pointradius": 2,"points": false,"renderer": "flot","seriesOverrides": [],"spaceLength": 10,"stack": false,"steppedLine": false,"targets": [{"alias": "$tag_request_type $tag_name","groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT \"time\", \"response_time\"\nFROM \"locust_requests\"\nWHERE $timeFilter\nGROUP BY \"request_type\", \"name\"","rawQuery": true,"refId": "A","resultFormat": "time_series","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"thresholds": [],"timeRegions": [],"title": "Response Time Over TIme","tooltip": {"shared": true,"sort": 0,"value_type": "individual"},"type": "graph","xaxis": {"mode": "time","show": true,"values": []},"yaxes": [{"format": "short","logBase": 1,"show": true},{"format": "short","logBase": 1,"show": true}],"yaxis": {"align": false}},{"aliasColors": {},"bars": false,"dashLength": 10,"dashes": false,"datasource": {"uid": "$DB_SOURCE"},"description": "Number of requests per second over time.","fieldConfig": {"defaults": {"links": []},"overrides": []},"fill": 1,"fillGradient": 0,"gridPos": {"h": 7,"w": 24,"x": 0,"y": 16},"hiddenSeries": false,"id": 25,"legend": {"alignAsTable": true,"avg": true,"current": true,"max": true,"min": true,"rightSide": true,"show": false,"total": false,"values": true},"lines": true,"linewidth": 1,"nullPointMode": "null","options": {"alertThreshold": true},"percentage": false,"pluginVersion": "8.3.4","pointradius": 2,"points": false,"renderer": "flot","seriesOverrides": [],"spaceLength": 10,"stack": false,"steppedLine": false,"targets": [{"alias": "$tag_request_type $tag_name","groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT \"time\", count(\"counter\")\nFROM \"locust_requests\"\nWHERE $timeFilter\nGROUP BY time(1s), \"request_type\"","rawQuery": true,"refId": "A","resultFormat": "time_series","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"thresholds": [],"timeRegions": [],"title": "Requests Per Second Over Time","tooltip": {"shared": true,"sort": 0,"value_type": "individual"},"type": "graph","xaxis": {"mode": "time","show": true,"values": []},"yaxes": [{"$$hashKey": "object:4502","decimals": 0,"format": "none","label": "","logBase": 1,"show": true},{"$$hashKey": "object:4503","format": "short","logBase": 1,"show": false}],"yaxis": {"align": false}},{"columns": [],"datasource": {"uid": "$DB_SOURCE"},"description": "Hatching Events","fontSize": "100%","gridPos": {"h": 7,"w": 12,"x": 0,"y": 23},"id": 24,"interval": "","pageSize": 10,"scroll": true,"showHeader": true,"sort": {"col": 2,"desc": true},"styles": [{"alias": "","align": "auto","colors": ["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat": "YYYY-MM-DD HH:mm:ss","decimals": 2,"mappingType": 1,"pattern": "Time","thresholds": [],"type": "date","unit": "short"},{"alias": "Event","align": "auto","colors": ["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat": "YYYY-MM-DD HH:mm:ss","decimals": 2,"mappingType": 1,"pattern": "locust_events.event","thresholds": [],"type": "number","unit": "short"},{"alias": "Node ID","align": "auto","colors": ["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat": "YYYY-MM-DD HH:mm:ss","decimals": 2,"mappingType": 1,"pattern": "locust_events.node_id","thresholds": [],"type": "number","unit": "short"},{"alias": "User Count","align": "auto","colors": ["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat": "YYYY-MM-DD HH:mm:ss","decimals": 2,"mappingType": 1,"pattern": "locust_events.user_count","thresholds": [],"type": "number","unit": "short"}],"targets": [{"alias": "","groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT \"time\", \"event\", \"user_count\"\nFROM \"locust_events\" \nWHERE $timeFilter\nAND event <> '\''papaya'\''","rawQuery": true,"refId": "A","resultFormat": "time_series","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"title": "Hatching Events","transform": "timeseries_to_columns","type": "table-old"},{"columns": [],"datasource": {"uid": "$DB_SOURCE"},"fontSize": "100%","gridPos": {"h": 7,"w": 12,"x": 12,"y": 23},"id": 29,"pageSize": 10,"scroll": true,"showHeader": true,"sort": {"col": 2,"desc": true},"styles": [{"alias": "Time","align": "auto","dateFormat": "YYYY-MM-DD HH:mm:ss","pattern": "Time","type": "hidden"},{"alias": "Error","align": "auto","colors": ["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat": "YYYY-MM-DD HH:mm:ss","decimals": 2,"mappingType": 1,"pattern": "Metric","preserveFormat": false,"sanitize": true,"thresholds": [],"type": "string","unit": "short"},{"alias": "Total","align": "auto","colors": ["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat": "YYYY-MM-DD HH:mm:ss","decimals": 0,"mappingType": 1,"pattern": "Value","thresholds": [],"type": "number","unit": "none"}],"targets": [{"alias": "$tag_request_type $tag_name: $tag_exception","groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT count(\"counter\")\nFROM \"locust_requests\"\nWHERE $timeFilter AND exception <> '\''None'\''\nGROUP BY \"request_type\", \"name\", \"exception\"","rawQuery": true,"refId": "A","resultFormat": "time_series","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"title": "Request Errors","transform": "timeseries_to_rows","type": "table-old"},{"columns": [],"datasource": {"uid": "$DB_SOURCE"},"fontSize": "100%","gridPos": {"h": 6,"w": 24,"x": 0,"y": 30},"id": 22,"pageSize": 10,"scroll": true,"showHeader": true,"sort": {"col": 2,"desc": true},"styles": [{"alias": "Time","align": "auto","dateFormat": "YYYY-MM-DD HH:mm:ss","pattern": "Time","type": "hidden"},{"alias": "Error","align": "auto","colors": ["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals": 2,"link": false,"pattern": "exception_tag","preserveFormat": true,"sanitize": true,"thresholds": [],"type": "string","unit": "short"},{"alias": "Total","align": "auto","colors": ["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat": "YYYY-MM-DD HH:mm:ss","decimals": 0,"mappingType": 1,"pattern": "count","thresholds": [],"type": "number","unit": "none"}],"targets": [{"groupBy": [{"params": ["$__interval"],"type": "time"},{"params": ["null"],"type": "fill"}],"orderByTime": "ASC","policy": "default","query": "SELECT count(\"exception\")\nFROM \"locust_exceptions\" \nWHERE $timeFilter\nGROUP BY \"exception_tag\"","rawQuery": true,"refId": "A","resultFormat": "table","select": [[{"params": ["value"],"type": "field"},{"params": [],"type": "mean"}]],"tags": []}],"title": "Locust Errors","transform": "table","type": "table-old"}],"refresh": "5s","schemaVersion": 34,"style": "dark","tags": ["locust"],"templating": {"list": [{"current": {"selected": false,"text": "InfluxDB-1","value": "InfluxDB-1"},"hide": 0,"includeAll": false,"label": "DB_SOURCE","multi": false,"name": "DB_SOURCE","options": [],"query": "influxdb","queryValue": "","refresh": 1,"regex": "/.*/","skipUrlSync": false,"type": "datasource"}]},"time": {"from": "now-3h","to": "now"},"timepicker": {"refresh_intervals": ["2s","5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone": "browser","title": "Locust Dashboard","uid": "l-rF7woGz","version": 2,"weekStart": ""}}'

# Importing Kubernetes Prometheus dashboard
curl --location --request POST 'http://'$Grafana_URL'/api/dashboards/db' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw '{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"canDelete":true,"slug":"kubernetes-cluster-prometheus","url":"/d/4XuMd2Iiz/kubernetes-cluster-prometheus","expires":"0001-01-01T00:00:00Z","created":"2023-01-18T14:32:40Z","updated":"2023-01-19T05:12:57Z","updatedBy":"admin","createdBy":"admin","version":2,"hasAcl":false,"isFolder":false,"folderId":0,"folderUid":"","folderTitle":"General","folderUrl":"","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":true,"canEdit":true,"canDelete":true},"organization":{"canAdd":true,"canEdit":true,"canDelete":true}},"hasPublicDashboard":false,"publicDashboardAccessToken":"","publicDashboardUid":"","publicDashboardEnabled":false},"dashboard":{"annotations":{"list":[{"$$hashKey":"object:3607","builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"Summary metrics about containers running on Kubernetes nodes.\r\n\r\nDashboard was taken from here.  This version does not reqiure you to\r\nsetup the Kubernetes-app plugin. (https://github.com/grafana/kubernetes-app)\r\n\r\nUse this Helm chart to launch Grafana into a Kubernetes cluster.  It will include this dashboard and many more dashboards to give you visibility into the Kubernetes Cluster. (https://github.com/sekka1/cloud-public/tree/master/kubernetes/pods/grafana-helm)","editable":true,"fiscalYearStartMonth":0,"gnetId":6417,"graphTooltip":1,"id": "null","links":[{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":false,"tags":["kubernetes-app"],"title":"Dashboards","type":"dashboards"}],"liveNow":false,"panels":[{"collapsed":false,"datasource":{"type":"datasource","uid":"grafana"},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":14,"panels":[],"targets":[{"datasource":{"type":"datasource","uid":"grafana"},"refId":"A"}],"title":"Deployments","type":"row"},{"columns":[{"text":"Current","value":"current"}],"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fontSize":"100%","gridPos":{"h":8,"w":24,"x":0,"y":1},"id":16,"links":[],"scroll":true,"showHeader":true,"sort":{"col":1,"desc":true},"styles":[{"alias":"Time","align":"auto","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"","align":"auto","colorMode":"row","colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":0,"pattern":"Metric","thresholds":["0","0",".9"],"type":"string","unit":"none"},{"alias":"","align":"auto","colorMode":"row","colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":0,"link":false,"pattern":"Value","thresholds":["0","1"],"type":"number","unit":"none"}],"targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"kube_deployment_status_replicas{namespace=~\"$namespace\"}","format":"time_series","instant":true,"interval":"","intervalFactor":1,"legendFormat":"{{ deployment }}","refId":"A"}],"title":"Deployment Replicas - Up To Date","transform":"timeseries_to_rows","type":"table-old"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":5,"w":6,"x":0,"y":9},"id":24,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_node_info{node=~\"$node\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"Number Of Nodes","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":5,"w":6,"x":6,"y":9},"id":18,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_deployment_status_replicas{namespace=~\"$namespace\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"Deployment Replicas","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":5,"w":6,"x":12,"y":9},"id":19,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_deployment_status_replicas_updated{namespace=~\"$namespace\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"Deployment Replicas - Updated","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":5,"w":6,"x":18,"y":9},"id":20,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_deployment_status_replicas_unavailable{namespace=~\"$namespace\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"Deployment Replicas - Unavailable","type":"stat"},{"collapsed":false,"datasource":{"type":"datasource","uid":"grafana"},"gridPos":{"h":1,"w":24,"x":0,"y":14},"id":28,"panels":[],"targets":[{"datasource":{"type":"datasource","uid":"grafana"},"refId":"A"}],"title":"Pods","type":"row"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"#629e51","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":15},"id":30,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_status_phase{namespace=~\"$namespace\", phase=\"Running\"})","format":"time_series","interval":"","intervalFactor":1,"refId":"A"}],"title":"Pods Running","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"#629e51","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":15},"id":31,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_status_phase{namespace=~\"$namespace\", phase=\"Pending\"})","format":"time_series","interval":"","intervalFactor":1,"refId":"A"}],"title":"Pods Pending","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"#629e51","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":8,"x":0,"y":18},"id":32,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_status_phase{namespace=~\"$namespace\", phase=\"Failed\"})","format":"time_series","interval":"","intervalFactor":1,"refId":"A"}],"title":"Pods Failed","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"#629e51","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":8,"x":8,"y":18},"id":33,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_status_phase{namespace=~\"$namespace\", phase=\"Succeeded\"})","format":"time_series","interval":"","intervalFactor":1,"refId":"A"}],"title":"Pods Succeeded","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"#629e51","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":8,"x":16,"y":18},"id":34,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_status_phase{namespace=~\"$namespace\", phase=\"Unknown\"})","format":"time_series","interval":"","intervalFactor":1,"refId":"A"}],"title":"Pods Unknown","type":"stat"},{"collapsed":false,"datasource":{"type":"datasource","uid":"grafana"},"gridPos":{"h":1,"w":24,"x":0,"y":21},"id":36,"panels":[],"targets":[{"datasource":{"type":"datasource","uid":"grafana"},"refId":"A"}],"title":"Containers","type":"row"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(31, 120, 193)","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":0,"y":22},"id":38,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_container_status_running{namespace=~\"$namespace\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"Containers Running","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(31, 120, 193)","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":6,"y":22},"id":39,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_container_status_waiting{namespace=~\"$namespace\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"Containers Waiting","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(31, 120, 193)","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":12,"y":22},"id":40,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_container_status_terminated{namespace=~\"$namespace\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"Containers Terminated","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(31, 120, 193)","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":18,"y":22},"id":41,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(delta(kube_pod_container_status_restarts{namespace=\"kube-system\"}[30m]))","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"Containers Restarts (Last 30 Minutes)","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(31, 120, 193)","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":0,"y":25},"id":43,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_container_resource_requests_cpu_cores{namespace=~\"$namespace\", node=~\"$node\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"CPU Cores Requested by Containers","type":"stat"},{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(31, 120, 193)","mode":"fixed"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"decbytes"},"overrides":[]},"gridPos":{"h":3,"w":12,"x":12,"y":25},"id":42,"links":[],"maxDataPoints":100,"options":{"colorMode":"none","graphMode":"area","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.3.2","targets":[{"datasource":{"type":"prometheus","uid":"2yPzzSo4k"},"expr":"sum(kube_pod_container_resource_requests_memory_bytes{namespace=~\"$namespace\", node=~\"$node\"})","format":"time_series","intervalFactor":1,"refId":"A"}],"title":"Memory Requested By Containers","type":"stat"}],"schemaVersion":37,"style":"dark","tags":["kubernetes","kubernetes-app"],"templating":{"list":[{"current":{"selected":false,"text":"No data sources found","value":""},"hide":2,"includeAll":false,"label":"","multi":false,"name":"datasource","options":[],"query":"prometheus","refresh":1,"regex":"/$ds/","skipUrlSync":false,"type":"datasource"},{"current":{"selected":true,"text":".*","value":".*"},"hide":0,"name":"node","options":[{"selected":true,"text":".*","value":".*"}],"query":".*","skipUrlSync":false,"type":"textbox"},{"current":{"selected":true,"text":".*","value":".*"},"hide":0,"name":"namespace","options":[{"selected":true,"text":".*","value":".*"}],"query":".*","skipUrlSync":false,"type":"textbox"}]},"time":{"from":"now-30m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"Kubernetes Pods","uid":"4XuMd2Iiz","version":4,"weekStart":""}}'


#Importing Node exporter dashboard
#curl --location --request POST 'http://'$Grafana_URL'/api/dashboards/db' \--header 'Authorization: Bearer '$token \--header 'Content-Type: application/json' --data-raw ''